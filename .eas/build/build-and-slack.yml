build:
  name: Create a build and send a Slack message
  steps:
    - eas/build
    - eas/send_slack_message:
        if: ${ success() }
        name: Send Slack message when the build succeeds
        inputs:
          slack_hook_url: 'https://hooks.slack.com/services/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'
          payload:
            blocks:
              - type: header
                text:
                  type: plain_text
                  text: ':applelogowhite: Build completed successfully for iOS :kiwico:'
                  emoji: true
              - type: 'section'
                fields:
                  - type: 'mrkdwn'
                    text: |
                      *Build Profile:* ${eas.metadata.buildProfile}
                      *Version:* ${eas.metadata.appVersion}
                      *Build:* ${eas.metadata.appBuildVersion}
              - type: 'actions'
                elements:
                  - type: 'button'
                    text:
                      type: 'plain_text'
                      text: 'Download IPA'
                    url: itms-services://?action=download-manifest;url=https://exp.host/--/api/v2/projects/${eas.metadata.appId}/builds/${eas.metadata.id}/manifest.plist
                  - type: 'button'
                    text:
                      type: 'plain_text'
                      text: 'Open Build Details Page'
                    url: ${eas.job.expoBuildUrl}
              - type: 'image'
                image_url: |
                  `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(itms-services://?action=download-manifest;url=https://exp.host/--/api/v2/projects/${eas.metadata.appId}/builds/${eas.metadata.id}/manifest.plist)}&size=250x250&qzone=2`
                alt_text: qr
