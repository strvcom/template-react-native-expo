build:
  name: Create a build and send a Slack message
  steps:
    - eas/build
    - eas/send_slack_message:
        if: ${ success() }
        name: Send Slack message when the build succeeds
        inputs:
          slack_hook_url: 'https://hooks.slack.com/services/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'
          payload:
            blocks:
              - type: header
                text:
                  type: plain_text
                  text: ':applelogowhite: Build completed successfully for iOS :kiwico:'
                  emoji: true
              - type: 'section'
                fields:
                  - type: 'mrkdwn'
                    text: |
                      *Build Profile*: ${eas.metadata.buildProfile}
                      *Version:* ${eas.metadata.appVersion}
                      *Build*: ${eas.metadata.appBuildVersion}
                      *Project ID*: ${eas.metadata.trackingContext.project_id}
                      *URL*: itms-services://?action=download-manifest;url=https://exp.host/--/api/v2/projects/${ eas.metadata.trackingContext.project_id }/builds/${ eas.env.EAS_BUILD_ID }/manifest.plist
              - type: 'actions'
                elements:
                  - type: 'button'
                    text:
                      type: 'plain_text'
                      text: 'Download IPA'
                    url: ${eas.job.expoBuildUrl}
                  - type: 'button'
                    text:
                      type: 'plain_text'
                      text: 'Download IPA'
                    url: ${eas.job.expoBuildUrl}
              - type: image
                image_url: https://api.qrserver.com/v1/create-qr-code/?data=itms-services://?action=download-manifest;url=https://exp.host/--/api/v2/projects/${ eas.metadata.trackingContext.project_id }/builds/${ eas.env.EAS_BUILD_ID }/manifest.plist&size=250x250&qzone=2
                alt_text: QR code
